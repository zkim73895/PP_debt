#!/usr/bin/env python3
"""
–ü—Ä–æ—Å—Ç–æ–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
"""

import http.server
import socketserver
import os
import sys

PORT = 3000
FRONTEND_DIR = "frontend"


class Handler(http.server.SimpleHTTPRequestHandler):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, directory=FRONTEND_DIR, **kwargs)

    def log_message(self, format, *args):
        # –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        pass


def serve_frontend():
    """–ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞"""
    print(f"üåê –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ http://localhost:{PORT}")
    print(f"üìÅ –û–±—Å–ª—É–∂–∏–≤–∞–µ–º–∞—è –ø–∞–ø–∫–∞: {os.path.abspath(FRONTEND_DIR)}")
    print("\nüìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∞–π–ª—ã:")

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∞–π–ª—ã
    for file in os.listdir(FRONTEND_DIR):
        if file.endswith('.html'):
            print(f"   ‚Ä¢ http://localhost:{PORT}/{file}")

    print("\n‚ö° –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω. Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.")

    try:
        with socketserver.TCPServer(("", PORT), Handler) as httpd:
            httpd.serve_forever()
    except KeyboardInterrupt:
        print("\nüëã –°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
    except OSError as e:
        if e.errno == 48:  # Address already in use
            print(f"‚ùå –ü–æ—Ä—Ç {PORT} —É–∂–µ –∑–∞–Ω—è—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç.")
        else:
            raise


if __name__ == "__main__":
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
    if not os.path.exists(FRONTEND_DIR):
        print(f"‚ùå –ü–∞–ø–∫–∞ '{FRONTEND_DIR}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!")
        print("–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É frontend –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç—É–¥–∞ HTML —Ñ–∞–π–ª—ã.")
        sys.exit(1)

    serve_frontend()